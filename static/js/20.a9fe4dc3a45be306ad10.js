webpackJsonp([20,7],{"6eiP":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={name:"DeviceInfoCenter",components:{DeviceInfoCommunityBuilderSetInfo:i("xnHJ").default},mounted:function(){},created:function(){console.info("传递参数："+this.$route.query),this.init()},data:function(){return{selectValue1:"1",editableTabsValue:"1",editableTabs:[],vueObj:[{caption:"NB传感器",id:"1",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!0}]}},watch:{},methods:{showPublicMsg:function(e,t){t(this.$refs.cb.showPublicInfo())},showQuery:function(){console.info("this.$route.query:"+this.$route.query.orgid),console.info("this.$route.query:"+this.customGlobal.decrypt(this.$route.query.caption,this.customGlobal.cryptoKey)),console.info("this.$route.query:"+this.$route.query.id)},init:function(){var e=this;this.editableTabs=[];for(var t=function(){var t=e.vueObj[o].vue;e.editableTabs.push({title:e.vueObj[o].caption,name:e.vueObj[o].id,content:function(){return i("aLCr")("./components"+t).catch(function(t){e.$message({type:"error",showClose:!0,duration:0,dangerouslyUseHTMLString:!0,message:'<spand style="color:black;">出错了：'+t+"</spand>"})})}})},o=0;o<this.vueObj.length;o++)t()},trigerChildObj:function(e,t){console.info("tab.name:"+e.name);for(var i=0;i<this.vueObj.length;i++)this.vueObj[i].show=!1;this.vueObj[e.name-1].show=!0},changeSel:function(e){console.info("当前选择："+this.selectValue1),"1"===this.selectValue1?this.vueObj=[{caption:"NB传感器",id:"1",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!0}]:"2"===this.selectValue1?this.vueObj=[{caption:"采集计算器",id:"1",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!0},{caption:"智能温控阀",id:"2",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!1},{caption:"温度传感器",id:"3",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!1},{caption:"楼栋热量表",id:"4",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!1}]:"3"===this.selectValue1&&(this.vueObj=[{caption:"二网平衡阀",id:"1",vue:"/views/deviceManager/DeviceInfoGateWayExample.vue",show:!0}]),this.editableTabsValue="1",this.init()}}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"new-tabs1 new-tabs2",staticStyle:{"_margin-left":"20px",position:"relative"}},[i("el-select",{staticClass:"new-select1 new-select2 new-select3",staticStyle:{position:"absolute",left:"10px",top:"0px",width:"150px","z-index":"999"},attrs:{placeholder:"请选择","popper-append-to-body":!1},on:{change:function(t){return e.changeSel(t)}},model:{value:e.selectValue1,callback:function(t){e.selectValue1=t},expression:"selectValue1"}},[i("el-option",{key:"1",attrs:{label:"室温采集",value:"1"}}),e._v(" "),i("el-option",{key:"2",attrs:{label:"温度面积法",value:"2"}}),e._v(" "),i("el-option",{key:"3",attrs:{label:"二网平衡",value:"3"}})],1),e._v(" "),i("el-tabs",{style:{height:"200px"},on:{"tab-click":e.trigerChildObj},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,function(t,o){return i("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[e.vueObj[o].show?i(t.content,{tag:"component",attrs:{pri_detail:{treeNodeCaptions:e.$route.query.caption,treeNodeIds:e.$route.query.id,treeNodeOrgId:e.$route.query.orgid,currentTreeNode:e.$route.query.cur_obj,treeNodeType:e.$route.query.type,cbInfo:e.$route.query.cb_info}},on:{parent_method:e.showPublicMsg}}):e._e()],1)}),1),e._v(" "),i("device-info-community-builder-set-info",{ref:"cb"})],1)},staticRenderFns:[]};var n=i("VU/8")(o,r,!1,function(e){i("WeV4")},"data-v-675df0f6",null);t.default=n.exports},OaFA:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("fZjL"),r=i.n(o),n=i("BO1k"),a=i.n(n),s=i("mvHQ"),l=i.n(s),c=i("Vhou"),u={name:"DeviceInfoIndex",components:{DeviceInfoCenter:i("6eiP").default},data:function(){return{dialogFormVisible1:!1,editableTabs:[],activeName:"1",communityRows:[],cbInfo:{},oldCbInfo:{},dialogLeft:0,dialogTop:0,curTreeNode:null,curTreeData:null,icon1:"el-icon-caret-left",showTree:!0,currentSelTreeNodeId:"",currentSelTreeNodeIds:[],treeDataStatus:{},treeData:[]}},destroyed:function(){},mounted:function(){},created:function(){this.initOrgTemplateInfo()},watch:{currentSelTreeNodeId:function(e,t){e!==t&&c.a.$emit("globalMsgForDeviceInfoCommunityBuilder",{community:{ci_uuid:"",ci_community_name:""},builder:{bi_build_number:"",bi_uuid:""}})}},methods:{mouseLeave:function(){this.manualHandleTreeNodeClick(this.curTreeData,this.curTreeNode),this.dialogFormVisible1=!1},notifySelBuilderInfo:function(e){this.cbInfo=e,console.info("选择的楼栋信息:"+l()(this.cbInfo)),this.manualHandleTreeNodeClick(this.curTreeData,this.curTreeNode),this.dialogFormVisible1=!1},notifySelCommunity:function(){this.manualHandleTreeNodeClick(this.curTreeData,this.curTreeNode),this.dialogFormVisible1=!1},queryCommunity:function(e){var t=this,o=this;this.editableTabs=[],console.info("当前ID："+e.id);var r={ci_station_id:e.id};this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postQueryCommunityKV,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()(r)})).then(function(e){if(console.log("异步调用成功返回:"+l()(e)),"success"==e.data.status){t.communityRows=e.data.rows,t.communityRows.length>0&&(t.communityRows[0].status=!0,t.activeName=t.communityRows[0].ci_uuid);for(var r=0;r<t.communityRows.length;r++){t.editableTabs.push({title:t.communityRows[r].ci_community_name,name:t.communityRows[r].ci_uuid,show:t.communityRows[r].status,content:function(){return i.e(9).then(i.bind(null,"iLPs")).catch(function(e){t.$message({type:"error",showClose:!0,duration:0,dangerouslyUseHTMLString:!0,message:'<spand style="color:black;">出错了：'+e+"</spand>"})})}})}}else console.info("查询失败"),o.communityRows=[],t.$alert(e.data.msg,"查询失败",{confirmButtonText:"确定",callback:function(i){console.info("data:"+l()(e.data)),"请登录认证"===e.data.msg&&"failed"===e.data.status&&t.$router.replace({path:"/login"})}})},function(e){console.log("异步调用出错:"+l()(e)),o.communityRows=[],t.$alert(l()(e.message),"查询出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(e){console.log("异步调用失败返回:"+l()(e)),o.communityRows=[],t.$alert(l()(e.message),"查询出错",{confirmButtonText:"确定",callback:function(e){}})})},removeTreeNode:function(e,t){var i=e.parent,o=i.data.detail||i.data,r=o.findIndex(function(e){return e.id===t.id});o.splice(r,1)},initTreeDataStatus:function(e,t){var i=this,o=t.node,n=t.data;t.store;if("{}"===l()(this.treeDataStatus))return 4===n.type?e("span",{style:"font-size:14px;"},[e("span",[n.caption]),e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return i.showOrgInfo(n,o,e)}}},["选择"])]):e("span",{style:"font-size:14px;"},[e("span",[n.caption])]);var s=!1,c=!0,u=!1,d=void 0;try{for(var h,f=a()(r()(this.treeDataStatus));!(c=(h=f.next()).done);c=!0){var p=h.value;if(n.id===p)return 4===n.type?e("span",{style:"font-size:14px;"},[e("span",[n.caption]),e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return i.showOrgInfo(n,o,e)}}},["选择"])]):e("span",{style:"font-size:14px;"},[e("span",[n.caption])])}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}if(!1===s){if("0"===n.id)return e("span",{style:"font-size:14px;"},[e("span",[n.caption])]);this.removeTreeNode(o,n)}},initOrgTemplateInfo:function(){var e=this;this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postQueryOrganTemplate,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()({config:"all",username:this.customGlobal.userInfoExt.cui_login_id})})).then(function(t){console.log("异步调用成功返回:"+l()(t)),"success"==t.data.status?("0"===e.customGlobal.userInfoExt.cui_type?e.treeData=[JSON.parse(t.data.organ)]:e.treeData=JSON.parse(t.data.organ).detail,e.treeDataStatus=JSON.parse(t.data.orgkey),console.info("treeData:"+l()(e.treeData)),console.info("treeDataStatus:"+l()(e.treeDataStatus))):(console.info("查询失败"),"请登录认证"===t.data.msg&&"failed"===t.data.status?e.$router.replace({path:"/login"}):(e.treeData=[JSON.parse(t.data.organ)],e.treeDataStatus=JSON.parse(t.data.orgkey)))},function(t){console.log("异步调用出错:"+l()(t)),e.$alert(l()(t.message),"查询出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(t){console.log("异步调用失败返回:"+l()(t)),e.$alert(l()(t.message),"查询出错",{confirmButtonText:"确定",callback:function(e){}})})},showOrgInfo:function(e,t,i){null!==this.$refs.org_tree.getCurrentKey()&&this.$refs.org_tree.getCurrentKey()===e.id&&i.stopPropagation(),this.curTreeData=e,this.curTreeNode=t,this.dialogFormVisible1=!0,console.info("e.pageX :"+i.pageX),console.info("e.clientX :"+i.clientX);var o=i.target.getBoundingClientRect();console.info("rect.left:"+o.left),console.info("rect.top:"+o.top),this.dialogLeft=o.left+10,this.dialogTop=o.top/2,this.queryCommunity(e)},showHiddenTree:function(){this.showTree?this.icon1="el-icon-caret-right":this.icon1="el-icon-caret-left",this.showTree=!this.showTree,console.info("是否显示："+this.showTree)},handleTreeNodeClick:function(e,t){4!==e.type&&!0===this.dialogFormVisible1&&(this.dialogFormVisible1=!1),console.info("2点击事件,可在此处理对应逻辑_data:"+l()(e)+",node展开状态:"+t.expanded);var i=[],o=[],r=[],n=[];i.push(this.$refs.org_tree.getCurrentNode().caption),o.push(this.$refs.org_tree.getCurrentNode().id),r.push(this.$refs.org_tree.getCurrentNode().type+""),n.push({id:this.$refs.org_tree.getCurrentNode().id,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""}),this.getTreeNodeParentCaption(i,o,r,n,this.$refs.org_tree.getCurrentNode());this.$refs.org_tree.getNode(this.$refs.org_tree.getCurrentNode()).level;if(this.currentSelTreeNodeId!==this.$refs.org_tree.getCurrentKey()){this.currentSelTreeNodeId=this.$refs.org_tree.getCurrentKey();for(var a=0;a<i.length;a++)i[a]=this.customGlobal.encrypt(i[a],this.customGlobal.cryptoKey);this.$router.push({name:"device_query",path:"/device_query",query:{orgid:this.currentSelTreeNodeId,caption:i.reverse(),id:o.reverse(),cur_obj:{orgid:this.currentSelTreeNodeId,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""},type:r.reverse(),obj:n.reverse(),cb_info:this.cbInfo}}),this.currentSelTreeNodeIds=o.reverse(),console.info("2currentSelTreeNodeIds:"+this.currentSelTreeNodeIds)}else{c.a.$emit("globalMsgForDeviceInfoCommunityBuilder",{community:{ci_uuid:"",ci_community_name:""},builder:{bi_build_number:"",bi_uuid:""}}),this.cbInfo={community:{ci_uuid:"",ci_community_name:""},builder:{bi_build_number:"",bi_uuid:""}},this.currentSelTreeNodeId=this.$refs.org_tree.getCurrentKey();for(a=0;a<i.length;a++)i[a]=this.customGlobal.encrypt(i[a],this.customGlobal.cryptoKey);this.$router.push({name:"device_query",path:"/device_query",query:{orgid:this.currentSelTreeNodeId,caption:i.reverse(),id:o.reverse(),cur_obj:{orgid:this.currentSelTreeNodeId,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""},type:r.reverse(),obj:n.reverse(),cb_info:this.cbInfo}}),this.currentSelTreeNodeIds=o.reverse(),console.info("3currentSelTreeNodeIds:"+this.currentSelTreeNodeIds)}},manualHandleTreeNodeClick:function(e,t){4!==e.type&&!0===this.dialogFormVisible1&&(this.dialogFormVisible1=!1),console.info("1点击事件,可在此处理对应逻辑_data:"+l()(e)+",node展开状态:"+t.expanded);var i=[],o=[],r=[],n=[];i.push(this.$refs.org_tree.getCurrentNode().caption),o.push(this.$refs.org_tree.getCurrentNode().id),r.push(this.$refs.org_tree.getCurrentNode().type+""),n.push({id:this.$refs.org_tree.getCurrentNode().id,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""}),this.getTreeNodeParentCaption(i,o,r,n,this.$refs.org_tree.getCurrentNode());this.$refs.org_tree.getNode(this.$refs.org_tree.getCurrentNode()).level;if(this.currentSelTreeNodeId!==this.$refs.org_tree.getCurrentKey());else if(this.oldCbInfo!==this.cbInfo){this.currentSelTreeNodeId=this.$refs.org_tree.getCurrentKey();for(var a=0;a<i.length;a++)i[a]=this.customGlobal.encrypt(i[a],this.customGlobal.cryptoKey);this.$router.push({name:"device_query",path:"/device_query",query:{orgid:this.currentSelTreeNodeId,caption:i.reverse(),id:o.reverse(),cur_obj:{orgid:this.currentSelTreeNodeId,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""},type:r.reverse(),obj:n.reverse(),cb_info:this.cbInfo}}),this.currentSelTreeNodeIds=o.reverse(),console.info("1currentSelTreeNodeIds:"+this.currentSelTreeNodeIds),this.oldCbInfo=this.cbInfo}else console.info("1选择楼栋未发生变化。")},getTreeNodeParentCaption:function(e,t,i,o,r){for(var n=this.$refs.org_tree.getNode(r),a=n.level,s=1;s<a;)void 0!==n.parent&&(e.push(n.parent.label),t.push(n.parent.key),i.push(n.parent.data.type+""),o.push({id:n.parent.key,caption:n.parent.label,type:n.parent.data.type+""}),n=this.$refs.org_tree.getNode(n.parent),s++);return{label:e,key:t,type:i,obj:o}},trigerChildObj:function(e,t){console.info("点击tab.name:"+e.name),c.a.$emit("globalMsgForDeviceInfoCommunityBuilder",{community:{ci_uuid:e.name,ci_community_name:e.label},builder:{bi_build_number:"",bi_uuid:""}}),this.cbInfo={community:{ci_uuid:e.name,ci_community_name:e.label},builder:{bi_build_number:"",bi_uuid:""}}},trigerChildObjExt:function(e,t){console.info("点击tab.name:"+e),c.a.$emit("globalMsgForDeviceInfoCommunityBuilder",{community:{ci_uuid:e,ci_community_name:t},builder:{bi_build_number:"",bi_uuid:""}}),this.cbInfo={community:{ci_uuid:e,ci_community_name:t},builder:{bi_build_number:"",bi_uuid:""}},this.dialogFormVisible1=!1}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"new-tree1 new-tree2"},[i("el-card",{staticClass:"new-card1 new-card2",attrs:{shadow:"always"}},[i("el-container",{staticStyle:{width:"100%",border:"1px solid #eee"}},[e.showTree?i("el-aside",{staticStyle:{height:"calc(100vh)","background-color":"rgb(238, 241, 246)"},attrs:{width:"200px"}},[e.showTree?i("el-tree",{ref:"org_tree",staticStyle:{height:"calc(100vh)"},attrs:{data:e.treeData,"default-expand-all":"","node-key":"id","highlight-current":"",props:{children:"detail",label:"caption"},"render-content":e.initTreeDataStatus},on:{"node-click":e.handleTreeNodeClick}}):e._e()],1):e._e(),e._v(" "),i("el-container",{staticStyle:{width:"100%",border:"1px solid #eee"}},[i("el-aside",{staticStyle:{height:"calc(100vh)","background-color":"rgb(238, 241, 246)"},attrs:{width:"25px"}},[i("i",{class:e.icon1,staticStyle:{height:"100%",display:"flex",width:"25px","flex-direction":"row","justify-content":"center","align-items":"center"},on:{click:e.showHiddenTree}})]),e._v(" "),i("el-main",{staticStyle:{height:"100%","padding-top":"0px"}},[i("device-info-center")],1)],1)],1)],1),e._v(" "),i("el-dialog",{staticClass:"new-dialog-1 new-dialog1 new-dialog2 new-scroll1",style:{left:this.dialogLeft+"px",top:this.dialogTop+"px"},attrs:{visible:e.dialogFormVisible1,id:"new-dialog-1","close-on-press-escape":!0,"close-on-click-modal":!0,"show-close":!0,modal:!1},on:{"update:visible":function(t){e.dialogFormVisible1=t},close:e.notifySelCommunity}},[i("div",{staticClass:"new-tabs1-1 new-tabs2 new-tabs3 new-tabs31 new-tabs4 new-tabs41 new-scroll1",on:{mouseleave:e.mouseLeave}},[i("el-tabs",{staticStyle:{height:"400px"},attrs:{type:"border-card","tab-position":"left"},on:{"tab-click":e.trigerChildObj},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.editableTabs,function(t,o){return i("el-tab-pane",{key:t.name,staticStyle:{width:"100%"},attrs:{label:t.title,name:t.name}},[i("el-tooltip",{staticClass:"item-tabs",attrs:{slot:"label",effect:"dark",content:t.title,placement:"left"},slot:"label"},[i("span",[e._v(" "+e._s(t.title.length>10?t.title.substring(0,9)+"...":t.title)+" ")])]),e._v(" "),i("el-scrollbar",{staticStyle:{height:"350px","max-height":"350px"}},[t.show?i(t.content,{ref:t.name,refInFor:!0,tag:"component",attrs:{pri_detail:{communityObj:{id:t.name,title:t.title}}},on:{parent_method:e.notifySelBuilderInfo}}):e._e()],1)],1)}),1)],1)])],1)},staticRenderFns:[]};var h=i("VU/8")(u,d,!1,function(e){i("ybVr")},"data-v-41b77990",null);t.default=h.exports},WeV4:function(e,t){},ybVr:function(e,t){}});
//# sourceMappingURL=20.a9fe4dc3a45be306ad10.js.map