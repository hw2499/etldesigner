webpackJsonp([18,6],{"1d92":function(e,t){},H9Y0:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={name:"OrgInfoCenterBank",mounted:function(){},created:function(){console.info("传递参数："+this.$route.query),this.init()},data:function(){return{editableTabsValue:"1",editableTabs:[],vueObj:[{caption:"机构信息",id:"1",vue:"/views/bankPlatform/orgInfo/OrgInfoBank.vue",show:!0},{caption:"设备信息",id:"2",vue:"/views/bankPlatform/orgInfo/DeviceInfoBank.vue",show:!1}]}},watch:{},methods:{showPublicMsg:function(e,t){t(this.$refs.cb.showPublicInfo())},showQuery:function(){console.info("this.$route.query:"+this.$route.query.orgid),console.info("this.$route.query:"+this.customGlobal.decrypt(this.$route.query.caption,this.customGlobal.cryptoKey)),console.info("this.$route.query:"+this.$route.query.id)},init:function(){for(var e=this,t=function(){var t=e.vueObj[n].vue;e.editableTabs.push({title:e.vueObj[n].caption,name:e.vueObj[n].id,content:function(){return o("aLCr")("./components"+t).catch(function(t){e.$message({type:"error",showClose:!0,duration:0,dangerouslyUseHTMLString:!0,message:'<spand style="color:black;">出错了：'+t+"</spand>"})})}})},n=0;n<this.vueObj.length;n++)t()},trigerChildObj:function(e,t){console.info("tab.name:"+e.name);for(var o=0;o<this.vueObj.length;o++)this.vueObj[o].show=!1;this.vueObj[e.name-1].show=!0}}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"new-tabs1",staticStyle:{"_margin-left":"20px"}},[o("el-tabs",{style:{height:"200px"},on:{"tab-click":e.trigerChildObj},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,function(t,n){return o("el-tab-pane",{key:t.name,attrs:{label:t.title,name:t.name}},[e.vueObj[n].show?o(t.content,{tag:"component",attrs:{pri_detail:{treeNodeCaptions:e.$route.query.caption,treeNodeIds:e.$route.query.id,treeNodeOrgId:e.$route.query.orgid,currentTreeNode:e.$route.query.cur_obj,treeNodeType:e.$route.query.type,cbInfo:e.$route.query.cb_info}},on:{parent_method:e.showPublicMsg}}):e._e()],1)}),1)],1)},staticRenderFns:[]};var s=o("VU/8")(n,r,!1,function(e){o("HNw6")},"data-v-a3ceb292",null);t.default=s.exports},HNw6:function(e,t){},UlLO:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("fZjL"),r=o.n(n),s=o("BO1k"),a=o.n(s),i=o("mvHQ"),l=o.n(i),c=o("Vhou"),u={name:"OrgInfoIndexBank",components:{OrgInfoCenterBank:o("H9Y0").default},data:function(){return{dialogFormVisible1:!1,editableTabs:[],activeName:"1",communityRows:[],cbInfo:{},oldCbInfo:{},dialogLeft:0,dialogTop:0,curTreeNode:null,curTreeData:null,icon1:"el-icon-caret-left",showTree:!0,currentSelTreeNodeId:"",currentSelTreeNodeIds:[],treeDataStatus:{},treeData:[],defaultTreeKey:[]}},destroyed:function(){c.a.$off("globalMsgBank")},mounted:function(){var e=this;c.a.$on("globalMsgBank",function(t){if(console.log("监听到的消息："+t),"1"===t.method)e.addTreeNode(t.curid,t.target,t.layer),e.defaultTreeKey.push(t.target.id);else if("2"===t.method)e.modifyTreeNode(t.curid,t.target);else if("3"===t.method){e.delTreeNode(t.curid);var o=e.defaultTreeKey.indexOf(t.curid);-1!=o&&e.defaultTreeKey.slice(o,1)}})},created:function(){this.initOrgTemplateInfo()},watch:{currentSelTreeNodeId:function(e,t){e!==t&&c.a.$emit("globalMsgForCommunityBuilder",{community:{ci_uuid:"",ci_community_name:""},builder:{bi_build_number:"",bi_uuid:""}})}},methods:{queryCommunity:function(e){var t=this,n=this;this.editableTabs=[],console.info("当前ID："+e.id);var r={ci_station_id:e.id};this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postQueryCommunityKV,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()(r)})).then(function(e){if(console.log("异步调用成功返回:"+l()(e)),"success"==e.data.status){t.communityRows=e.data.rows,t.communityRows.length>0&&(t.communityRows[0].status=!0,t.activeName=t.communityRows[0].ci_uuid);for(var r=0;r<t.communityRows.length;r++){t.editableTabs.push({title:t.communityRows[r].ci_community_name,name:t.communityRows[r].ci_uuid,show:t.communityRows[r].status,content:function(){return o.e(1).then(o.bind(null,"HNKV")).catch(function(e){t.$message({type:"error",showClose:!0,duration:0,dangerouslyUseHTMLString:!0,message:'<spand style="color:black;">出错了：'+e+"</spand>"})})}})}}else console.info("查询失败"),n.communityRows=[],t.$alert(e.data.msg,"查询失败",{confirmButtonText:"确定",callback:function(o){console.info("data:"+l()(e.data)),"请登录认证"===e.data.msg&&"failed"===e.data.status&&t.$router.replace({path:"/login"})}})},function(e){console.log("异步调用出错:"+l()(e)),n.communityRows=[],t.$alert(l()(e.message),"查询出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(e){console.log("异步调用失败返回:"+l()(e)),n.communityRows=[],t.$alert(l()(e.message),"查询出错",{confirmButtonText:"确定",callback:function(e){}})})},removeTreeNode:function(e,t){var o=e.parent,n=o.data.detail||o.data,r=n.findIndex(function(e){return e.id===t.id});n.splice(r,1)},initTreeDataStatus:function(e,t){var o=this,n=t.node,s=t.data;t.store;if("{}"===l()(this.treeDataStatus))return 4e3===s.type?e("span",{style:"font-size:14px;"},[e("span",[s.caption]),e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return o.showOrgInfo(s,n,e)}}},["选择"])]):e("span",{style:"font-size:14px;"},[e("span",[s.caption])]);var i=!1,c=!0,u=!1,d=void 0;try{for(var g,h=a()(r()(this.treeDataStatus));!(c=(g=h.next()).done);c=!0){var f=g.value;if(s.id===f)return 4e3===s.type?e("span",{style:"font-size:14px;"},[e("span",[s.caption]),e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return o.showOrgInfo(s,n,e)}}},["选择"])]):e("span",{style:"font-size:14px;"},[e("span",[s.caption])])}}catch(e){u=!0,d=e}finally{try{!c&&h.return&&h.return()}finally{if(u)throw d}}if(!1===i){if("0"===s.id)return e("span",{style:"font-size:14px;"},[e("span",[s.caption])]);this.removeTreeNode(n,s)}},initOrgTemplateInfo:function(){var e=this;this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postQueryOrganTemplate,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()({config:"all",username:this.customGlobal.userInfoExt.cui_login_id})})).then(function(t){console.log("异步调用成功返回:"+l()(t)),"success"==t.data.status?("0"===e.customGlobal.userInfoExt.cui_type?e.treeData=[JSON.parse(t.data.organ)]:e.treeData=JSON.parse(t.data.organ).detail,e.treeDataStatus=JSON.parse(t.data.orgkey),console.info("treeData:"+l()(e.treeData)),console.info("treeDataStatus:"+l()(e.treeDataStatus))):(console.info("查询失败"),"请登录认证"===t.data.msg&&"failed"===t.data.status?e.$router.replace({path:"/login"}):(e.treeData=[JSON.parse(t.data.organ)],e.treeDataStatus=JSON.parse(t.data.orgkey)))},function(t){console.log("异步调用出错:"+l()(t)),e.$alert(l()(t.message),"查询出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(t){console.log("异步调用失败返回:"+l()(t)),e.$alert(l()(t.message),"查询出错",{confirmButtonText:"确定",callback:function(e){}})})},showOrgInfo:function(e,t,o){null!==this.$refs.org_tree.getCurrentKey()&&this.$refs.org_tree.getCurrentKey()===e.id&&o.stopPropagation(),this.curTreeData=e,this.curTreeNode=t,this.dialogFormVisible1=!0,console.info("e.pageX :"+o.pageX),console.info("e.clientX :"+o.clientX);var n=o.target.getBoundingClientRect();console.info("rect.left:"+n.left),console.info("rect.top:"+n.top),this.dialogLeft=n.left+10,this.dialogTop=n.top/2},showHiddenTree:function(){this.showTree?this.icon1="el-icon-caret-right":this.icon1="el-icon-caret-left",this.showTree=!this.showTree,console.info("是否显示："+this.showTree)},handleTreeNodeClick:function(e,t){4!==e.type&&!0===this.dialogFormVisible1&&(this.dialogFormVisible1=!1),console.info("2点击事件,可在此处理对应逻辑_data:"+l()(e)+",node展开状态:"+t.expanded);var o=[],n=[],r=[],s=[];o.push(this.$refs.org_tree.getCurrentNode().caption),n.push(this.$refs.org_tree.getCurrentNode().id),r.push(this.$refs.org_tree.getCurrentNode().type+""),s.push({id:this.$refs.org_tree.getCurrentNode().id,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""}),this.getTreeNodeParentCaption(o,n,r,s,this.$refs.org_tree.getCurrentNode());this.$refs.org_tree.getNode(this.$refs.org_tree.getCurrentNode()).level;if(this.currentSelTreeNodeId!==this.$refs.org_tree.getCurrentKey()){this.currentSelTreeNodeId=this.$refs.org_tree.getCurrentKey();for(var a=0;a<o.length;a++)o[a]=this.customGlobal.encrypt(o[a],this.customGlobal.cryptoKey);this.$router.push({name:"org_query_bank",path:"/org_query_bank",query:{orgid:this.currentSelTreeNodeId,caption:o.reverse(),id:n.reverse(),cur_obj:{orgid:this.currentSelTreeNodeId,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""},type:r.reverse(),obj:s.reverse(),cb_info:this.cbInfo}}),this.currentSelTreeNodeIds=n.reverse(),console.info("2currentSelTreeNodeIds:"+this.currentSelTreeNodeIds)}else{c.a.$emit("globalMsgForCommunityBuilder",{community:{ci_uuid:"",ci_community_name:""},builder:{bi_build_number:"",bi_uuid:""}}),this.cbInfo={community:{ci_uuid:"",ci_community_name:""},builder:{bi_build_number:"",bi_uuid:""}},this.currentSelTreeNodeId=this.$refs.org_tree.getCurrentKey();for(a=0;a<o.length;a++)o[a]=this.customGlobal.encrypt(o[a],this.customGlobal.cryptoKey);this.$router.push({name:"org_query_bank",path:"/org_query_bank",query:{orgid:this.currentSelTreeNodeId,caption:o.reverse(),id:n.reverse(),cur_obj:{orgid:this.currentSelTreeNodeId,caption:this.$refs.org_tree.getCurrentNode().caption,type:this.$refs.org_tree.getCurrentNode().type+""},type:r.reverse(),obj:s.reverse(),cb_info:this.cbInfo}}),this.currentSelTreeNodeIds=n.reverse(),console.info("3currentSelTreeNodeIds:"+this.currentSelTreeNodeIds)}},getTreeNodeParentCaption:function(e,t,o,n,r){for(var s=this.$refs.org_tree.getNode(r),a=s.level,i=1;i<a;)void 0!==s.parent&&(e.push(s.parent.label),t.push(s.parent.key),o.push(s.parent.data.type+""),n.push({id:s.parent.key,caption:s.parent.label,type:s.parent.data.type+""}),s=this.$refs.org_tree.getNode(s.parent),i++);return{label:e,key:t,type:o,obj:n}},addTreeNode:function(e,t,o){var n=this;if(0!=this.currentSelTreeNodeIds.length){this.customGlobal.checkPermissionId(e,this.treeData,t,o,"1");var r=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, .0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postManagerOrganTemplate,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()({currentNodeId:e,targetNode:t,layer:o,username:this.customGlobal.userInfoExt.cui_login_id,orgids:this.currentSelTreeNodeIds,flag:"1"})})).then(function(e){console.log("异步调用成功返回:"+l()(e)),"success"==e.data.status?(console.info("创建成功"),n.initOrgTemplateInfo(),n.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 组织机构 ['+t.caption+"] 创建成功</span>"}),r.close()):(console.info("创建失败"),n.$message({type:"warning",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 组织机构 ['+t.caption+"] 创建失败</span>"}),r.close())},function(e){console.log("异步调用出错:"+l()(e)),r.close(),n.$alert(l()(e.message),"保存出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(e){console.log("异步调用失败返回:"+l()(e)),r.close(),n.$alert(l()(e.message),"保存出错",{confirmButtonText:"确定",callback:function(e){}})})}else this.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 请选择组织机构树</span>'})},delTreeNode:function(e){var t=this;this.customGlobal.checkPermissionId(e,this.treeData,{},"1","3");var o=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, .0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postManagerOrganTemplate,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()({currentNodeId:e,targetNode:{},layer:"1",username:this.customGlobal.userInfoExt.cui_login_id,orgids:this.currentSelTreeNodeIds,flag:"3"})})).then(function(n){console.log("异步调用成功返回:"+l()(n)),"success"==n.data.status?(console.info("删除成功"),t.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 组织机构删除成功</span>'}),o.close()):(console.info("删除失败"),t.$message({type:"warning",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 组织机构删除失败 ['+e+"]</span>"}),o.close())},function(e){console.log("异步调用出错:"+l()(e)),o.close(),t.$alert(l()(e.message),"删除出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(e){console.log("异步调用失败返回:"+l()(e)),o.close(),t.$alert(l()(e.message),"删除出错",{confirmButtonText:"确定",callback:function(e){}})})},modifyTreeNode:function(e,t){var o=this;this.customGlobal.checkPermissionId(e,this.treeData,t,"1","2");var n=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, .0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.postManagerOrganTemplate,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:l()({currentNodeId:e,targetNode:t,layer:"1",username:this.customGlobal.userInfoExt.cui_login_id,orgids:this.currentSelTreeNodeIds,flag:"2"})})).then(function(e){console.log("异步调用成功返回:"+l()(e)),"success"==e.data.status?(console.info("修改成功"),o.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 组织机构 ['+t.caption+"] 修改成功</span>"}),n.close()):(console.info("修改失败"),o.$message({type:"warning",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;"> 组织机构 ['+t.caption+"] 修改失败</span>"}),n.close())},function(e){console.log("异步调用出错:"+l()(e)),n.close(),o.$alert(l()(e.message),"修改出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(e){console.log("异步调用失败返回:"+l()(e)),n.close(),o.$alert(l()(e.message),"修改出错",{confirmButtonText:"确定",callback:function(e){}})})}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"new-tree1 new-tree2"},[o("el-card",{staticClass:"new-card1 new-card2",attrs:{shadow:"always"}},[o("el-container",{staticStyle:{width:"100%",border:"1px solid #eee",height:"calc(100vh - 120px)"}},[e.showTree?o("el-aside",{staticStyle:{height:"100%","background-color":"rgb(238, 241, 246)"},attrs:{width:"200px"}},[e.showTree?o("el-tree",{ref:"org_tree",staticStyle:{height:"100%"},attrs:{data:e.treeData,"default-expanded-keys":e.defaultTreeKey,"node-key":"id","highlight-current":"",props:{children:"detail",label:"caption"},"render-content":e.initTreeDataStatus},on:{"node-click":e.handleTreeNodeClick}}):e._e()],1):e._e(),e._v(" "),o("el-container",{staticStyle:{width:"100%",border:"1px solid #eee"}},[o("el-aside",{staticStyle:{height:"100%","background-color":"rgb(238, 241, 246)"},attrs:{width:"25px"}},[o("i",{class:e.icon1,staticStyle:{height:"100%",display:"flex",width:"25px","flex-direction":"row","justify-content":"center","align-items":"center"},on:{click:e.showHiddenTree}})]),e._v(" "),o("el-main",{staticStyle:{height:"100%","padding-top":"0px"}},[o("org-info-center-bank")],1)],1)],1)],1)],1)},staticRenderFns:[]};var g=o("VU/8")(u,d,!1,function(e){o("1d92")},"data-v-c38c7bf8",null);t.default=g.exports}});
//# sourceMappingURL=18.b0cfce1343453369315f.js.map