webpackJsonp([46],{"93bE":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o("BO1k"),a=o.n(n),i=o("d7EF"),l=o.n(i),s=o("mvHQ"),r=o.n(s),c=o("ifoU"),d=o.n(c),u={name:"DeviceGraphExample.vue",mounted:function(){this.dragControllerDiv(),this.init()},data:function(){return{graphJson:"{}",graphJsonClone:{},selectBtn:"select",sceneModel:"nodrag",currentNode:void 0,currentContainer:void 0,publicScene:null,publicStage:null,dialogFormVisible1:!1,publicRows:new d.a,publicNodes:new d.a}},methods:{init:function(){var t=document.getElementById("canvas_graph"),e=new JTopo.Stage(t);e.eagleEye.visible=!1;var o=new JTopo.Scene(e);o.alpha=1,o.backgroundColor="63,74,89",o.mode=this.sceneModel,this.publicScene=o,this.publicStage=e},createNode:function(t,e,o){var n=this,a=new JTopo.TextNode(t.type);return a.setLocation(1,1),a.setSize(20,20),a.alpha=1,a.showSelected=!1,a.jsonObj=t,a.graphId=e,a.paintSelected=function(t){0!=this.showSelected&&(t.save(),t.beginPath(),t.strokeStyle="rgba(218,221,221, 0)",t.fillStyle="rgba(218,221,221,0)",t.arc(0,0,this.width/2+3,0,2*Math.PI,!1),t.fill(),t.stroke(),t.closePath(),t.restore())},console.info("创建货道"+e+","+t.type),a.addEventListener("dbclick",function(t){a.dragable=!a.dragable,n.currentNode=t.target,n.currentContainer=void 0,console.info("货道text："+n.currentNode.text)}),o.add(a),a},createContainerForNode:function(t,e){var o=this,n=new JTopo.Container(t.id);n.textPosition="Middle_Center",n.fontColor="255,255,255",n.font="18pt 微软雅黑",n.fillColor="128,128,128",n.borderColor="255,0,0",n.alpha=1,n.setBound(parseFloat(t.x),parseFloat(t.y),parseFloat(t.width),parseFloat(t.height)),n.jsonObj=t,n.graphId=t.id,"正常"===t.status?n.fillColor="0,176,0":"故障"===t.status?n.fillColor="255,0,0":"未知"===t.status&&(n.fillColor="128,128,128");var a=JTopo.layout.GridLayout(4,3);n.layout=a,console.info("货道号:"+t.id);var i=this.createNode(t,t.id,e);return n.add(i),n.addEventListener("dbclick",function(t){n.dragable=!n.dragable,o.currentContainer=t.target,o.currentNode=void 0,console.info("货道容器："+o.currentContainer.text),o.dialogFormVisible1=!0}),this.publicNodes.set(t.id,n),e.add(n),n},createRowContainer:function(t,e){var o=new JTopo.Container;o.textPosition="Middle_Center",o.fontColor="100,255,0",o.font="18pt 微软雅黑",o.fillColor="255,255,255",o.borderColor="255,0,0",o.setBound(parseFloat(t.x),parseFloat(t.y),parseFloat(t.width),parseFloat(t.height)),e.add(o);for(var n=t.detail,a=0;a<n.length;a++){var i=this.createContainerForNode(n[a],e);o.add(i)}return o},createRowContainer1:function(t,e){var o=new JTopo.Container(t.id);return o.textPosition="Middle_Center",o.fontColor="100,255,0",o.font="18pt 微软雅黑",o.fillColor="255,0,0",o.borderColor="255,0,0",o.setBound(parseInt(t.x),parseInt(t.y),parseInt(t.w),parseInt(t.h)),e.add(o),o},autoDraw:function(){this.publicScene.clear(),this.removeAllNodes();for(var t=JSON.parse(this.graphJson).detail,e=0;e<t.length;e++){console.info("行号:"+t[e].row);t[e].detail;var o=this.createRowContainer(t[e],this.publicScene);this.publicRows.set(t[e].row,o)}},saveGraph:function(){this.findNode("2","0,176,0"),this.findNode("11","255,0,0"),this.findNode("33","255,0,0"),this.findNode("42","255,0,0"),this.findNode("56","255,0,0")},centerAndZoom:function(){this.publicRows.size>0?this.publicStage.centerAndZoom():console.info("请先生成货道图")},zoomOut:function(){this.publicRows.size>0?this.publicStage.zoomOut():console.info("请先生成货道图")},zoomIn:function(){this.publicRows.size>0?this.publicStage.zoomIn():console.info("请先生成货道图")},findNode:function(t,e){var o=this.publicNodes.get(t);o.graphId===t&&(console.info("找到节点"+r()(o.jsonObj)),o.fillColor=e);for(var n=!1,a=JSON.parse(this.graphJson).detail,i=0;i<a.length;i++){for(var l=a[i].detail,s=0;s<l.length;s++)if(l[s].id===t){n=!0,"0,176,0"===e?l[s].status="正常":"255,0,0"===e&&(l[s].status="故障");break}if(n){a[i].detail=l;break}}this.graphJsonClone=JSON.parse(this.graphJson),this.graphJsonClone.detail=a,this.graphJson=r()(this.graphJsonClone)},removeAllNodes:function(){var t=!0,e=!1,o=void 0;try{for(var n,i=a()(this.publicRows);!(t=(n=i.next()).done);t=!0){var s=n.value,r=l()(s,2),c=r[0],d=r[1];console.log("key:"+c,"value:"+d),this.publicScene.remove(this.publicRows.get(c))}}catch(t){e=!0,o=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw o}}},dragControllerDiv:function(){for(var t=document.getElementsByClassName("resize"),e=document.getElementsByClassName("left"),o=document.getElementsByClassName("mid"),n=document.getElementsByClassName("box"),a=function(a){t[a].onmousedown=function(i){t[a].style.background="#818181";var l=i.clientX;return t[a].left=t[a].offsetLeft,document.onmousemove=function(i){var s=i.clientX,r=t[a].left+(s-l),c=n[a].clientWidth-t[a].offsetWidth;r<32&&(r=32),r>c-150&&(r=c-150),t[a].style.left=r;for(var d=0;d<e.length;d++)e[d].style.width=r+"px",o[d].style.width=n[a].clientWidth-r-10+"px"},document.onmouseup=function(e){t[a].style.background="#d6d6d6",document.onmousemove=null,document.onmouseup=null,t[a].releaseCapture&&t[a].releaseCapture()},t[a].setCapture&&t[a].setCapture(),!1}},i=0;i<t.length;i++)a(i)}}},p={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"box",staticClass:"box"},[o("div",{staticClass:"left",staticStyle:{"min-width":"30%"}},[o("el-row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:12}},[o("el-col",{attrs:{span:4}},[o("span",{staticStyle:{"text-align":"center"}},[t._v("结构体")])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-tooltip",{attrs:{effect:"dark",content:"转换成货道图",placement:"bottom"}},[o("el-button",{staticClass:"el-icon-right",attrs:{size:"small"},on:{click:t.autoDraw}})],1)],1),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-tooltip",{attrs:{effect:"dark",content:"保存",placement:"bottom"}},[o("el-button",{staticClass:"el-icon-check",attrs:{size:"small"},on:{click:t.saveGraph}})],1)],1),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-tooltip",{attrs:{effect:"dark",content:"居中",placement:"bottom"}},[o("el-button",{staticClass:"el-icon-aim",attrs:{size:"small"},on:{click:t.centerAndZoom}})],1)],1),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-tooltip",{attrs:{effect:"dark",content:"放大",placement:"bottom"}},[o("el-button",{staticClass:"el-icon-zoom-in",attrs:{size:"small"},on:{click:t.zoomOut}})],1)],1),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-tooltip",{attrs:{effect:"dark",content:"缩小",placement:"bottom"}},[o("el-button",{staticClass:"el-icon-zoom-out",attrs:{size:"small"},on:{click:t.zoomIn}})],1)],1)],1),t._v(" "),o("el-input",{attrs:{type:"textarea",rows:40,placeholder:"请输入内容"},model:{value:t.graphJson,callback:function(e){t.graphJson=e},expression:"graphJson"}})],1),t._v(" "),o("div",{staticClass:"resize",attrs:{title:"收缩侧边栏"}},[t._v("\n        ⋮\n      ")]),t._v(" "),o("div",{staticClass:"mid",staticStyle:{"max-width":"70%"}},[o("el-row",{attrs:{gutter:12}},[o("el-col",{attrs:{span:24}},[o("span",{staticStyle:{"text-align":"center"}},[t._v("货道图")])])],1),t._v(" "),o("canvas",{attrs:{width:"700",height:"800",id:"canvas_graph"}})],1),t._v(" "),o("el-dialog",{attrs:{visible:t.dialogFormVisible1,"close-on-press-escape":!1,"close-on-click-modal":!1,"show-close":!0},on:{"update:visible":function(e){t.dialogFormVisible1=e}}},[o("div",{staticStyle:{"text-align":"left","font-size":"20px","font-weight":"bold"},attrs:{slot:"title"},slot:"title"},[o("span",[t._v(t._s())]),t._v(" "),o("span",[t._v(t._s())])])])],1)},staticRenderFns:[]};var h=o("VU/8")(u,p,!1,function(t){o("h6c1")},"data-v-5dd8e06d",null);e.default=h.exports},h6c1:function(t,e){}});
//# sourceMappingURL=46.11e355fcef6472c42d0e.js.map