webpackJsonp([73],{UQGP:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("mvHQ"),a=i.n(o),n=i("Xxa5"),s=i.n(n),l=i("exGp"),r=i.n(l),c=i("pFYg"),u=i.n(c),d=i("YZ0n"),p=i("mtWM"),_=i.n(p),g={name:"equipment_picture",components:{VueCropper:d.VueCropper},data:function(){return{tableDataequipment:"2",bdbi_id:"",img_tableData:[],banner_img:"",img_dialog:!1,tableDialgTitle:"",ruleForm:{di_uuid:""},cardBodyStyle:"padding-top:10px;padding-bottom:10px;",tableData_equipment:[],options:{img:"",outputSize:1,outputType:"png | jpeg | jpg",full:!0,canMove:!0,canMoveBox:!0,original:!1,autoCrop:!0,autoCropWidth:400,autoCropHeight:200,fixedBox:!0,enlarge:1,centerBox:!0,fixed:!0,fixedNumber:[1.77,1],maxImgSize:2e3,mode:"contain",high:!0,infoTrue:!0,title:"图像裁剪",details:"选择图片，上传"},dialogVisible:!1,imgsrc:""}},created:function(){this.select_equipment(),console.log("我的："+this.customGlobal.serverUrl.orgBaseURI)},computed:{scaleFun:function(){var t=this.scaleratioXY;return"transform:scale("+t+","+t+")"}},methods:{handleClose:function(t){var e=this;this.$confirm("确认关闭？").then(function(i){t(),e.onclose()}).catch(function(t){})},realTime:function(t){var e=this,i=t;this.$refs.cropper.getCropData(function(t){e.imgsrc=t,(i.w>=200||i.h>=200)&&(i.w>=i.h&&(e.scaleratioXY=200/i.w),i.h>i.w&&(e.scaleratioXY=200/i.h))})},uploadImg:function(t,e){var i=this,o=this,a=t.target.files[0];if(!/\.(jpg|jpeg|png|JPG|PNG)$/.test(t.target.value))return alert("图片类型必须是.gif,jpeg,jpg,png中的一种"),!1;var n=new FileReader;n.onload=function(t){var a=void 0;a="object"===u()(t.target.result)?window.URL.createObjectURL(new Blob([t.target.result])):t.target.result,1===e?o.options.img=a:2===e&&(i.example2.img=a)},n.readAsDataURL(a)},changeScale:function(t){t=t||1,this.$refs.cropper.changeScale(t)},rotateLeft:function(){this.$refs.cropper.rotateLeft()},rotateRight:function(){this.$refs.cropper.rotateRight()},oncropped:function(t){var e=this;this.$refs.reference.value="";"blob"===t?this.$refs.cropper.getCropBlob(function(t){}):this.$refs.cropper.getCropData(function(t){""===e.options.img?alert("您还没有选择图片"):(e.uploadFileToServer(t),e.dialogVisible=!1,e.options.img="",e.imgsrc="")})},onOpen:function(){this.dialogVisible=!0},dataURItoBlob:function(t){var e=void 0;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(e.length),a=0;a<e.length;a++)o[a]=e.charCodeAt(a);return new Blob([o],{type:i})},uploadFileToServer:function(t){var e=this;return r()(s.a.mark(function i(){var o;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:(o=new Image).src=t,o.onload=r()(s.a.mark(function i(){var o,a;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:o=e.dataURItoBlob(t),(a=new FormData).append("file",o,e.customGlobal.getFormatDateTimeString("3")+".png"),e.uploadFileRequest(a);case 4:case"end":return i.stop()}},i,e)}));case 3:case"end":return i.stop()}},i,e)}))()},uploadFileRequest:function(t){var e=this;return r()(s.a.mark(function i(){var o;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:o=e,_()({method:"post",url:e.customGlobal.serverUrl.orgBaseURI+"fr/postCallPowerFileUpload?userid="+e.customGlobal.userInfoExt.cui_login_id+"&logic=2",data:t,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(t){console.info("progressEvent:"+a()(t))}}).then(function(t){if(console.info("response:"+a()(t)),"success"===t.data.status){console.info("上传成功："+t.data.rawfilename);var e=o.customGlobal.serverUrl.orgBaseURI+"/fr/imgserver/"+t.data.rawfilename;console.info("图片："+e),o.banner_img=e,console.info("图片："+o.banner_img)}else console.info("上传失败")}).catch(function(t){console.log(t)});case 2:case"end":return i.stop()}},i,e)}))()},equipment_Selection:function(t){this.ruleForm.di_uuid=t,this.img_select()},select_equipment:function(){var t=this,e=this;e.tableData_equipment=[];var i={obj_bank_center_id:e.customGlobal.userInfoExt.cui_bank_center_id,obj_province_id:e.customGlobal.userInfoExt.cui_province_id,obj_city_id:e.customGlobal.userInfoExt.cui_city_id,obj_county_id:e.customGlobal.userInfoExt.cui_county_id,obj_station_id:e.customGlobal.userInfoExt.cui_station_id,perPageSize:1e3,currentPage:1},o=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.Device_unique_ID_select,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:a()(i)})).then(function(i){"success"===i.data.status?(o.close(),e.tableData_equipment=i.data.rows,e.tableData_equipment.length>0?e.tableDataequipment=1:e.tableDataequipment=0,e.tableData_equipment.forEach(function(t){t.Id=t.di_uuid.substring(t.di_uuid.length-9,t.di_uuid.length)}),0!==i.data.rows.length&&(e.ruleForm.di_uuid=e.tableData_equipment[0].di_uuid,t.img_select())):(console.info("设备id查询失败"),o.close(),"请登录认证"===i.data.msg&&t.$router.push({path:"/login"}))},function(e){o.close(),t.$alert(a()(e.message),"设备id查询失败!",{confirmButtonText:"确定",callback:function(t){}})}).catch(function(e){console.log("异步调用失败返回:"+a()(e)),o.close(),t.$alert(a()(e.message),"设备id查询失败",{confirmButtonText:"确定",callback:function(t){}})})},img_button:function(){this.banner_img="",this.img_dialog=!0,this.tableDialgTitle="新增广告"},img_submit:function(){var t=this,e=this,i={bdbi_device_id:e.ruleForm.di_uuid,bdbi_path:e.banner_img,bdbi_cui_id:e.customGlobal.userInfoExt.cui_uuid,bdbi_bank_center_id:e.customGlobal.userInfoExt.cui_bank_center_id,bdbi_province_id:e.customGlobal.userInfoExt.cui_province_id,bdbi_city_id:e.customGlobal.userInfoExt.cui_city_id,bdbi_county_id:e.customGlobal.userInfoExt.cui_county_id,bdbi_station_id:e.customGlobal.userInfoExt.cui_station_id,bdbi_duration:"",bdbi_caption:"",bdbi_describer:"",bdbi_type:"1",bdbi_status:"1",bdbi_order:"",bdbi_qr_type:""},o=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.Advertisement_add,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:a()(i)})).then(function(i){"success"==i.data.status?(o.close(),t.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;">图片上传成功</span>'}),e.img_dialog=!1,e.img_select()):(console.info("图片上传失败"),o.close(),"请登录认证"===i.data.msg&&t.$router.push({path:"/login"}))},function(e){o.close(),t.$alert(a()(e.message),"图片上传出错!",{confirmButtonText:"确定",callback:function(t){}})}).catch(function(e){console.log("异步调用失败返回:"+a()(e)),o.close(),t.$alert(a()(e.message),"图片上传出错",{confirmButtonText:"确定",callback:function(t){}})})},img_cancel:function(){this.img_dialog=!1},img_select:function(){var t=this,e=this,i={perPageSize:100,currentPage:1,obj_bank_center_id:e.customGlobal.userInfoExt.cui_bank_center_id,obj_province_id:e.customGlobal.userInfoExt.cui_province_id,obj_city_id:e.customGlobal.userInfoExt.cui_city_id,obj_county_id:e.customGlobal.userInfoExt.cui_county_id,obj_station_id:e.customGlobal.userInfoExt.cui_station_id,bdbi_type:"1",bdbi_status:"1",bdbi_device_id:e.ruleForm.di_uuid,bdbi_qr_type:""},o=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.Advertisement_select,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:a()(i)})).then(function(i){"success"===i.data.status?(o.close(),e.img_tableData=[],e.img_tableData=i.data.rows):(console.info("商品查询失败"),o.close(),"请登录认证"===i.data.msg&&t.$router.push({path:"/login"}))},function(e){o.close(),t.$alert(a()(e.message),"商品查询失败!",{confirmButtonText:"确定",callback:function(t){}})}).catch(function(e){console.log("异步调用失败返回:"+a()(e)),o.close(),t.$alert(a()(e.message),"商品查询失败",{confirmButtonText:"确定",callback:function(t){}})})},delete_img:function(t){var e=this,i=this;i.bdbi_id=t.bdbi_id,console.log(i.bdbi_id),this.$confirm("是否删除图片","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,closeOnClickModal:!1,closeOnPressEscape:!1}).then(function(){var t={bdbi_id:i.bdbi_id,bdbi_cui_id:i.customGlobal.userInfoExt.cui_uuid},o=e.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"});e.customGlobal.postHttpClient(e.customGlobal.serverUrl.Advertisement_delete,e.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},e.qs.stringify({jsondata:a()(t)})).then(function(t){"success"==t.data.status?(o.close(),e.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;">图片删除成功</span>'}),i.img_select()):(console.info("图片删除失败"),o.close(),"请登录认证"===t.data.msg&&e.$router.push({path:"/login"}))},function(t){o.close(),e.$alert(a()(t.message),"图片删除出错!",{confirmButtonText:"确定",callback:function(t){}})}).catch(function(t){console.log("异步调用失败返回:"+a()(t)),o.close(),e.$alert(a()(t.message),"图片删除出错",{confirmButtonText:"确定",callback:function(t){}})})}).catch(function(){e.$message({type:"info",message:"已取消操作"})})}}},b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{ref:"ruleForm",staticClass:"account-plat-formitem",staticStyle:{"text-align":"left","font-size":"20px"},attrs:{"label-position":"left",model:t.ruleForm,"label-width":"130px"},nativeOn:{submit:function(t){t.preventDefault()}}},[i("el-card",{staticClass:"account-plat-card1 account-plat-card2",attrs:{shadow:"always","body-style":t.cardBodyStyle}},[i("div",{staticStyle:{"margin-top":"10px"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{md:24}},[i("el-form-item",{attrs:{label:"选择设备:",prop:"di_uuid"}},[i("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择设备"},on:{change:t.equipment_Selection},model:{value:t.ruleForm.di_uuid,callback:function(e){t.$set(t.ruleForm,"di_uuid",e)},expression:"ruleForm.di_uuid"}},t._l(t.tableData_equipment,function(t){return i("el-option",{key:t.di_uuid,attrs:{label:t.Id,value:t.di_uuid}})}),1)],1)],1)],1)],1)])],1),t._v(" "),i("el-card",{staticClass:"account-plat-card1 account-plat-card2",attrs:{shadow:"always","body-style":t.cardBodyStyle}},[0==this.tableDataequipment?i("div",{staticStyle:{color:"red"}},[t._v("请先创建设备")]):t._e(),t._v(" "),1==this.tableDataequipment?i("div",{staticClass:"row",staticStyle:{display:"flex"}},[t._l(t.img_tableData,function(e,o){return void 0!==e.bdbi_path?i("div",{key:o,staticStyle:{margin:"30px"}},[i("div",{staticClass:"item",staticStyle:{height:"250px",width:"300px",color:"#4b86bc"}},[i("el-image",{staticStyle:{height:"150px",width:"300px"},attrs:{src:e.bdbi_path}}),t._v(" "),i("div",{staticStyle:{border:"1px solid #000",width:"300px"}},[i("div",{staticStyle:{"font-size":"14px",display:"flex","justify-content":"space-between"}},["1"===e.bdbi_type?i("div",[t._v("素材类型：图片")]):t._e(),t._v(" "),i("div",[t._v("播放时长：15秒")])]),t._v(" "),i("div",{staticStyle:{"font-size":"14px"}},[i("div",[t._v("发布人："+t._s(e.cui_realname))])]),t._v(" "),i("div",{staticStyle:{"font-size":"14px"}},[i("div",[t._v("发布日期："+t._s(e.bdbi_writetime_new))])]),t._v(" "),i("div",[i("div",{staticStyle:{cursor:"pointer","font-size":"16px",width:"100px",background:"#3a8ee6",color:"#fff",margin:"10px auto","border-radius":"5px"},on:{click:function(i){return t.delete_img(e)}}},[t._v("删除\n              ")])])])],1)]):t._e()}),t._v(" "),t.img_tableData.length<9?i("div",{staticStyle:{margin:"30px"}},[i("div",{staticStyle:{cursor:"pointer",height:"200px",width:"200px",color:"#4b86bc",border:"1px solid #000"},on:{click:function(e){return t.img_button()}}},[i("div",{staticStyle:{"padding-top":"30px","font-size":"80px","line-height":"80px"}},[t._v("+")]),t._v(" "),i("div",{staticStyle:{"font-size":"24px"}},[t._v("新增广告")])])]):t._e()],2):t._e()]),t._v(" "),i("el-dialog",{attrs:{visible:t.img_dialog,"close-on-press-escape":!1,"close-on-click-modal":!1,"show-close":!1},on:{"update:visible":function(e){t.img_dialog=e}}},[i("div",{staticStyle:{"text-align":"left","font-size":"20px","font-weight":"bold"},attrs:{slot:"title"},slot:"title"},[i("span",[t._v(t._s(this.tableDialgTitle))])]),t._v(" "),i("div",{staticStyle:{"margin-left":"100px"}},[i("div",{staticStyle:{display:"flex"}},[i("div",[t._v("上传广告：")]),t._v(" "),i("div",{staticStyle:{position:"relative","margin-left":"30px"}},[i("el-image",{staticStyle:{height:"200px",width:"350px"},attrs:{src:this.banner_img}}),t._v(" "),i("el-button",{staticStyle:{position:"absolute",top:"80px",left:"130px"},on:{click:function(e){return t.onOpen()}}},[t._v("上传图片")]),t._v(" "),i("div",[t._v("为保证设备端显示效果，图片分辨率建议1920*1080（像素）")]),t._v(" "),i("div",[t._v("图片格式：支持jpg、png、jpeg等常见格式")])],1)]),t._v(" "),i("div",{staticStyle:{display:"flex","margin-top":"30px"}},[i("div",[t._v("上传状态：")]),t._v(" "),i("div",{staticStyle:{position:"relative","margin-left":"30px"}},[""===this.banner_img?i("div",[t._v("待上传")]):t._e(),t._v(" "),""!==this.banner_img?i("div",{staticStyle:{color:"#5daf34"}},[t._v("上传成功")]):t._e()])])]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){return t.img_cancel()}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.img_submit()}}},[t._v("确 定")])],1)]),t._v(" "),i("el-dialog",{attrs:{title:t.options.title,visible:t.dialogVisible,"before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"el-cropper"},[i("div",[i("div",{staticStyle:{margin:"10px 0"}},[i("div",{staticStyle:{"font-weight":"600"}},[t._v("操作说明：")]),t._v(" "),i("div",[t._v("通过鼠标滚轮调整图片大小")]),t._v(" "),i("div",[t._v("通过鼠标左键调整裁剪框位置")])]),t._v(" "),i("div",{staticClass:"cropper-content"},[i("div",{staticClass:"cropper"},[i("vueCropper",{ref:"cropper",attrs:{img:t.options.img,outputSize:t.options.outputSize,outputType:t.options.outputType,full:t.options.full,canMove:t.options.canMove,canMoveBox:t.options.canMoveBox,original:t.options.original,autoCrop:t.options.autoCrop,autoCropWidth:t.options.autoCropWidth,autoCropHeight:t.options.autoCropHeight,fixedBox:t.options.fixedBox,enlarge:t.options.enlarge,centerBox:t.options.centerBox,fixedNumber:t.options.fixedNumber,fixed:t.options.fixed,maxImgSize:t.options.maxImgSize,mode:t.options.mode,infoTrue:t.options.infoTrue,high:t.options.high},on:{realTime:t.realTime}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"show-preview",style:{overflow:"hidden"}},[i("div",{staticClass:"wait"},[t._v("预览区域：")]),t._v(" "),i("div",{staticClass:"preview"},[i("img",{style:t.scaleFun,attrs:{src:t.imgsrc,alt:""}})])])])]),t._v(" "),i("div",{staticStyle:{"margin-top":"10px"}},[i("el-row",[i("el-col",{attrs:{span:6}},[i("div",[i("label",{staticClass:"el-button el-button--default",attrs:{for:"uploads1"}},[t._v("选择图片\n                "),i("input",{ref:"reference",staticStyle:{position:"absolute",clip:"rect(0 0 0 0)"},attrs:{type:"file",id:"uploads1",accept:"image/png, image/jpeg, image/jpg"},on:{change:function(e){return t.uploadImg(e,1)}}})])])]),t._v(" "),i("el-col",{attrs:{span:6}},[i("div",[i("el-button",{on:{click:t.rotateLeft}},[i("span",{staticStyle:{"font-weight":"600"}},[t._v("↺")])]),t._v(" "),i("el-button",{on:{click:t.rotateRight}},[i("span",{staticStyle:{"font-weight":"600"}},[t._v("↻")])])],1)]),t._v(" "),i("el-col",{attrs:{span:12}},[i("div",[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{on:{click:function(e){return t.oncropped("base64")}}},[t._v("确 定")])],1)])],1)],1)])])],1)},staticRenderFns:[]};var m=i("VU/8")(g,b,!1,function(t){i("tij1")},"data-v-0e89232c",null);e.default=m.exports},tij1:function(t,e){}});
//# sourceMappingURL=73.82fe2d5cbd3901998c0d.js.map