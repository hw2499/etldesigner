webpackJsonp([59],{FkOV:function(e,t){},zjsi:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),o=a.n(i),s={name:"TransactionRecord",data:function(){return{selectable:{value:"",list:[{value:"1",label:"按购买时间查询"},{value:"2",label:"按核销码查询"},{value:"3",label:"按特惠价手机号查询"}]},queryMsg:{phone:"",code:"",time:""},value1:"",phone1:"",pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},formData:{tableData:[{key:"订单号",value:"mbs_out_trade_no"},{key:"设备编号",value:"mbs_device_id"},{key:"核销码",value:"write_off_code"},{key:"商品名称",value:"mbgi_goods_name"},{key:"规格",value:"mbgi_goods_describer"},{key:"特惠价手机号",value:"mbs_guest_phone",identification:"2"},{key:"特惠价录入人员",value:"cui_realname",identification:"2"},{key:"商户名称",value:"mbmi_mer_name"},{key:"优惠类型",value:"mbs_pay_mode",identification:"1",list:["原价","优惠价","特惠价"]},{key:"支付金额（元）",value:"mbs_money_1",identification:"5"},{key:"支付时间",value:"mbs_writetime"},{key:"交付方式",value:"mbs_sale_mode",identification:"1",list:["机器交付","网点交付","到店交付"]},{key:"交付时间",value:"mbs_check_writetime",identification:"3"},{key:"核销人",value:"write_off_person",identification:"4"},{key:"商家实收（元）",value:"part4"},{key:"银行服务费（元）",value:"part2"},{key:"渠道服务费（元）",value:"part3"},{key:"平台服务费（元）",value:"part1"}]},tableData:[],queryParam:{totalRow:0,currentPage:1,pageSize:this.customGlobal.pageSize}}},watch:{"selectable.value":function(e){this.queryMsg.phone="",this.queryMsg.code="",this.queryMsg.time=""}},created:function(){this.queryParam.currentPage=1,this.query_name()},methods:{handleSizeChange:function(e){this.queryParam.pageSize=e,this.query_name()},handleCurrentChange:function(e){this.queryParam.currentPage=e,this.query_name()},query_name:function(){var e=this;if("2"==this.selectable.value&&this.queryMsg.code.length<7)this.$alert("核销码错误，请输入正确核销码","提示信息",{confirmButtonText:"确定",callback:function(e){}});else{var t=this;t.tableData=[];var a={perPageSize:t.queryParam.pageSize,currentPage:t.queryParam.currentPage,obj_bank_center_id:t.customGlobal.userInfoExt.cui_bank_center_id,obj_province_id:t.customGlobal.userInfoExt.cui_province_id,obj_city_id:t.customGlobal.userInfoExt.cui_city_id,obj_county_id:t.customGlobal.userInfoExt.cui_county_id,obj_station_id:t.customGlobal.userInfoExt.cui_station_id,mbs_guest_phone:this.queryMsg.phone,datatime:this.queryMsg.time[0],endtime:this.queryMsg.time[1],write_off_code:this.queryMsg.code},i=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"});this.customGlobal.postHttpClient(this.customGlobal.serverUrl.Transaction_record_select,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:o()(a)})).then(function(a){"success"===a.data.status?(i.close(),t.tableData=a.data.rows,t.tableData.forEach(function(t){var a="****"+t.mbs_out_trade_no.substring(t.mbs_out_trade_no.length-3),i=t.mbs_device_id.substring(t.mbs_device_id.length-9);e.$set(t,"mbs_device_id",i),e.$set(t,"code",a)}),t.queryParam.totalRow=a.data.total):(console.info("交易记录查询失败"),i.close(),"请登录认证"===a.data.msg&&e.$router.push({path:"/login"}))},function(t){i.close(),e.$alert(o()(t.message),"交易记录查询失败!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(t){console.log("异步调用失败返回:"+o()(t)),i.close(),e.$alert(o()(t.message),"交易记录查询失败",{confirmButtonText:"确定",callback:function(e){}})})}},platformAddRole:function(){var e=this,t={perPageSize:this.queryParam.pageSize,currentPage:this.queryParam.currentPage,mbs_guest_phone:this.queryMsg.phone,datatime:this.queryMsg.time[0],endtime:this.queryMsg.time[1],write_off_code:this.queryMsg.code,obj_bank_center_id:this.customGlobal.userInfoExt.cui_bank_center_id,obj_province_id:this.customGlobal.userInfoExt.cui_province_id,obj_city_id:this.customGlobal.userInfoExt.cui_city_id,obj_county_id:this.customGlobal.userInfoExt.cui_county_id,obj_station_id:this.customGlobal.userInfoExt.cui_station_id,exportTable:"excel",export_humankey:"订单号;设备编号;核销码;商品名称;规格;特惠价手机号;特惠价录入人员;商户名称;优惠类型;支付金额;支付时间;交付方式;交付时间;核销人;商家实收;银行服务费;渠道商服务费;平台服务费",export_key:"mbs_out_trade_no;equipment_no;write_off_code;mbgi_goods_name;mbgi_goods_describer;mbs_guest_phone;cui_realname;mbmi_mer_name;purchase_method;mbs_money_1_new;mbs_writetime;delivery_method;mbs_check_writetime;write_off_person;part4;part2;part3;part1"},a=this.$loading({lock:!0,text:"提交中...",target:".main",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0)"});this.customGlobal.postHttpClient2(this.customGlobal.serverUrl.Transaction_record_select,this.customGlobal.serverUrl.orgBaseURI,{"Content-Type":"application/x-www-form-urlencoded"},this.qs.stringify({jsondata:o()(t)})).then(function(t){a.close(),e.$message({type:"success",showClose:!0,duration:3e3,dangerouslyUseHTMLString:!0,message:'<span style="color:black;">导出数据成功</span>'})},function(t){a.close(),e.$alert(o()(t.message),"导出数据出错!",{confirmButtonText:"确定",callback:function(e){}})}).catch(function(t){console.log("异步调用失败返回:"+o()(t)),a.close(),e.$alert(o()(t.message),"导出数据出错",{confirmButtonText:"确定",callback:function(e){}})})},sortColumn:function(e){var t="";null!=e.order?("descending"===e.order?t="desc":"ascending"===e.order&&(t="asc"),this.sortOrderCol=e.prop+" "+t):this.sortOrderCol=""}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"TransactionRecord"},[a("el-card",[a("div",{staticStyle:{display:"flex",width:"100%",height:"50px","padding-left":"5px",margin:"10px 0 20px"}},[a("div",{staticStyle:{width:"120px","line-height":"40px"}},[e._v("自定义查询：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择查询方式"},model:{value:e.selectable.value,callback:function(t){e.$set(e.selectable,"value",t)},expression:"selectable.value"}},e._l(e.selectable.list,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"1"==e.selectable.value,expression:"selectable.value=='1'"}],staticStyle:{width:"400px",position:"relative"}},[a("el-date-picker",{attrs:{type:"daterange",align:"center","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.queryMsg.time,callback:function(t){e.$set(e.queryMsg,"time",t)},expression:"queryMsg.time"}}),e._v(" "),a("div",{staticStyle:{position:"absolute",top:"47px",left:"27px","font-size":"12px",color:"#c0c4cc"}},[e._v("\n          提示：不选择时间，默认查询全部记录\n        ")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"2"==e.selectable.value,expression:"selectable.value=='2'"}],staticStyle:{display:"flex",width:"400px",position:"relative"}},[a("div",{staticStyle:{width:"100px","line-height":"40px"}},[e._v("核销码：")]),e._v(" "),a("el-input",{staticStyle:{width:"275px"},attrs:{maxlength:7},model:{value:e.queryMsg.code,callback:function(t){e.$set(e.queryMsg,"code",t)},expression:"queryMsg.code"}}),e._v(" "),a("div",{staticStyle:{position:"absolute",top:"47px",left:"100px","font-size":"12px",color:"#c0c4cc"}},[e._v("\n          提示：不输入核销码，默认查询全部记录\n        ")])],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"3"==e.selectable.value,expression:"selectable.value=='3'"}],staticStyle:{display:"flex",width:"400px",position:"relative"}},[a("div",{staticStyle:{width:"100px","line-height":"40px"}},[e._v("手机号：")]),e._v(" "),a("el-input",{staticStyle:{width:"275px"},attrs:{maxlength:11},model:{value:e.queryMsg.phone,callback:function(t){e.$set(e.queryMsg,"phone",t)},expression:"queryMsg.phone"}}),e._v(" "),a("div",{staticStyle:{position:"absolute",top:"47px",left:"100px","font-size":"12px",color:"#c0c4cc"}},[e._v("\n          提示：不输入手机号，默认查询全部记录\n        ")])],1),e._v(" "),a("div",{staticStyle:{height:"40px","margin-left":"20px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.query_name}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.platformAddRole}},[a("i",{staticClass:"el-icon-edit"},[e._v("导出")])])],1)],1),e._v(" "),a("el-table",{ref:"tableData",staticClass:"account-plat-fixed-right account-plat-fixed",attrs:{border:"",data:e.tableData,"tooltip-effect":"dark","row-style":{height:"10px"},"cell-style":{padding:"5px 0px"},"header-cell-style":{background:"#4B86BC",color:"#ffffff",borderRight:"1px solid #E3E5EB",padding:"0px",height:"45px","line-height":"45px"}},on:{"sort-change":e.sortColumn}},[a("el-table-column",{attrs:{fixed:"",align:"center",type:"index",label:"序号",width:"50"}}),e._v(" "),e._l(e.formData.tableData,function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.value,label:t.key,align:"center","show-overflow-tooltip":"",width:"150"},scopedSlots:e._u([{key:"default",fn:function(i){return[1==t.identification?a("div",["1"===i.row[t.value]?a("el-tag",{attrs:{size:"small",effect:"dark",type:""}},[e._v(e._s(t.list[0]))]):e._e(),e._v(" "),"2"===i.row[t.value]?a("el-tag",{attrs:{size:"small",effect:"dark",type:"warning"}},[e._v(e._s(t.list[1])+"\n            ")]):e._e(),e._v(" "),"3"===i.row[t.value]?a("el-tag",{attrs:{size:"small",effect:"dark",type:"success"}},[e._v(e._s(t.list[2])+"\n            ")]):e._e()],1):2==t.identification?a("div",[e._v("\n            "+e._s(3==i.row.mbs_pay_mode&&i.row[t.value]||"-")+"\n          ")]):3==t.identification?a("div",[e._v("\n            "+e._s(i.row[t.value]?i.row[t.value]:"未交付")+"\n          ")]):4==t.identification?a("div",[e._v("\n            "+e._s("3"==i.row.mbs_sale_mode?i.row.bmc_name:i.row.write_off_person)+"\n          ")]):5==t.identification?a("div",[e._v("\n            "+e._s((1*i.row[t.value]).toFixed(2)||"-")+"\n          ")]):a("div",[e._v("\n            "+e._s(i.row[t.value]||"-")+"\n          ")])]}}],null,!0)})})],2),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{background:"","current-page":e.queryParam.currentPage,"page-sizes":[10,20,50,100,200],"page-size":e.queryParam.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.queryParam.totalRow},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var l=a("VU/8")(s,n,!1,function(e){a("FkOV")},"data-v-35e6f5b0",null);t.default=l.exports}});
//# sourceMappingURL=59.170f0c2c253feecda7d5.js.map